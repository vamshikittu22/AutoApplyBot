---
phase: 01-profile-management-resume-parsing
plan: 04
type: execute
wave: 3
depends_on: ['01-01', '01-02', '01-03']
files_modified:
  - src/lib/store/profile-store.ts
  - src/components/ProfileEditor.tsx
  - src/components/WorkExperienceEditor.tsx
  - src/components/EducationEditor.tsx
  - src/components/SkillsEditor.tsx
  - src/entrypoints/options/App.tsx
  - tests/unit/store/profile-store.test.ts
autonomous: true

must_haves:
  truths:
    - "User can paste resume and see parsed fields in editor"
    - "User can manually add/edit/delete work experience entries"
    - "User can manually add/edit/delete education entries"
    - "User can add/remove skills"
    - "User can select role preference (Tech/Healthcare/Finance/etc)"
    - "Profile saves to encrypted storage and persists after reload"
  artifacts:
    - path: "src/lib/store/profile-store.ts"
      provides: "Zustand store for profile state management"
      exports: ["useProfileStore"]
      min_lines: 100
    - path: "src/components/ProfileEditor.tsx"
      provides: "Main profile editing UI with resume paste"
      min_lines: 150
    - path: "src/components/WorkExperienceEditor.tsx"
      provides: "Work history add/edit/delete UI"
    - path: "src/components/EducationEditor.tsx"
      provides: "Education add/edit/delete UI"
    - path: "src/components/SkillsEditor.tsx"
      provides: "Skills management UI with tag input"
    - path: "src/entrypoints/options/App.tsx"
      provides: "Options page with ProfileEditor integrated"
  key_links:
    - from: "src/lib/store/profile-store.ts"
      to: "src/lib/storage/profile-storage"
      via: "Loads and saves profile"
      pattern: "loadProfile|saveProfile"
    - from: "src/lib/store/profile-store.ts"
      to: "src/lib/parser/resume-parser"
      via: "Parses resume text"
      pattern: "parseResume"
    - from: "src/components/ProfileEditor.tsx"
      to: "src/lib/store/profile-store"
      via: "Consumes profile state"
      pattern: "useProfileStore"
---

<objective>
Build React-based profile editor UI with Zustand state management.

**Purpose:** Allow users to paste resume, review parsed data, and manually edit all profile fields. Integrates parser (Plan 02) and storage (Plan 03) with React UI (REQ-PRO-02).

**Output:** Fully functional profile editor in extension options page with add/edit/delete for work experience, education, and skills.
</objective>

<execution_context>
@C:/Users/kittu/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/kittu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-profile-management-resume-parsing/01-01-SUMMARY.md
@.planning/phases/01-profile-management-resume-parsing/01-02-SUMMARY.md
@.planning/phases/01-profile-management-resume-parsing/01-03-SUMMARY.md
@TECHSTACK.md
@AGENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Profile Zustand Store</name>
  <files>src/lib/store/profile-store.ts</files>
  <action>
Create `src/lib/store/profile-store.ts` with Zustand state management for profile:

**Implementation requirements:**
- Use Zustand 5.0.11 (already installed in Phase 0)
- Integrate with parser (parseResume from Plan 02)
- Integrate with storage (saveProfile, loadProfile from Plan 03)
- Actions: loadProfile, saveProfile, parseResume, updatePersonal, addWorkExperience, updateWorkExperience, deleteWorkExperience, addEducation, updateEducation, deleteEducation, addSkill, deleteSkill, setRolePreference
- Track loading, saving, parsing states
- Track field confidence scores from parser

```typescript
import { create } from 'zustand'
import type { Profile, WorkExperience, Education, Skill, RolePreference } from '@/types/profile'
import type { FieldConfidence } from '@/types/resume'
import { parseResume as parseResumeUtil } from '@/lib/parser/resume-parser'
import { saveProfile as saveProfileUtil, loadProfile as loadProfileUtil } from '@/lib/storage/profile-storage'
import { EMPTY_PROFILE } from '@/constants/profile-schema'

interface ProfileState {
  // Data
  profile: Profile | null
  confidenceScores: FieldConfidence[]
  
  // UI state
  isLoading: boolean
  isSaving: boolean
  isParsing: boolean
  error: string | null
  lastSaved: string | null
  
  // Actions
  loadProfile: () => Promise<void>
  saveProfile: () => Promise<void>
  parseResume: (resumeText: string) => Promise<void>
  
  // Personal info
  updatePersonal: (updates: Partial<Profile['personal']>) => void
  
  // Work experience
  addWorkExperience: (experience: Omit<WorkExperience, 'id'>) => void
  updateWorkExperience: (id: string, updates: Partial<WorkExperience>) => void
  deleteWorkExperience: (id: string) => void
  
  // Education
  addEducation: (education: Omit<Education, 'id'>) => void
  updateEducation: (id: string, updates: Partial<Education>) => void
  deleteEducation: (id: string) => void
  
  // Skills
  addSkill: (skill: Skill) => void
  deleteSkill: (skillName: string) => void
  
  // Role preference
  setRolePreference: (role: RolePreference) => void
  
  // Domain extras
  updateDomainExtras: (updates: Partial<Profile['domainExtras']>) => void
  
  // Reset
  resetProfile: () => void
}

export const useProfileStore = create<ProfileState>((set, get) => ({
  // Initial state
  profile: null,
  confidenceScores: [],
  isLoading: false,
  isSaving: false,
  isParsing: false,
  error: null,
  lastSaved: null,
  
  // Load profile from storage
  loadProfile: async () => {
    set({ isLoading: true, error: null })
    try {
      const profile = await loadProfileUtil()
      set({ profile, isLoading: false })
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to load profile',
        isLoading: false 
      })
    }
  },
  
  // Save profile to encrypted storage
  saveProfile: async () => {
    const { profile } = get()
    if (!profile) {
      set({ error: 'No profile to save' })
      return
    }
    
    set({ isSaving: true, error: null })
    try {
      const updatedProfile = {
        ...profile,
        updatedAt: new Date().toISOString()
      }
      await saveProfileUtil(updatedProfile)
      set({ 
        profile: updatedProfile,
        isSaving: false,
        lastSaved: new Date().toISOString()
      })
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to save profile',
        isSaving: false 
      })
    }
  },
  
  // Parse resume text
  parseResume: async (resumeText: string) => {
    set({ isParsing: true, error: null })
    try {
      const result = await parseResumeUtil(resumeText)
      
      if (!result.success) {
        set({ 
          error: result.error,
          isParsing: false 
        })
        return
      }
      
      const { profile: parsedProfile, confidenceScores } = result.data
      
      // Merge parsed data with empty profile
      const profile: Profile = {
        ...EMPTY_PROFILE,
        ...parsedProfile,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      } as Profile
      
      set({ 
        profile,
        confidenceScores,
        isParsing: false 
      })
      
      // Auto-save after successful parse
      await get().saveProfile()
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Failed to parse resume',
        isParsing: false 
      })
    }
  },
  
  // Update personal info
  updatePersonal: (updates) => {
    const { profile } = get()
    if (!profile) return
    
    set({
      profile: {
        ...profile,
        personal: { ...profile.personal, ...updates }
      }
    })
  },
  
  // Add work experience
  addWorkExperience: (experience) => {
    const { profile } = get()
    if (!profile) return
    
    const newExperience: WorkExperience = {
      ...experience,
      id: crypto.randomUUID()
    }
    
    set({
      profile: {
        ...profile,
        workHistory: [...profile.workHistory, newExperience]
      }
    })
  },
  
  // Update work experience
  updateWorkExperience: (id, updates) => {
    const { profile } = get()
    if (!profile) return
    
    set({
      profile: {
        ...profile,
        workHistory: profile.workHistory.map(exp =>
          exp.id === id ? { ...exp, ...updates } : exp
        )
      }
    })
  },
  
  // Delete work experience
  deleteWorkExperience: (id) => {
    const { profile } = get()
    if (!profile) return
    
    set({
      profile: {
        ...profile,
        workHistory: profile.workHistory.filter(exp => exp.id !== id)
      }
    })
  },
  
  // Add education
  addEducation: (education) => {
    const { profile } = get()
    if (!profile) return
    
    const newEducation: Education = {
      ...education,
      id: crypto.randomUUID()
    }
    
    set({
      profile: {
        ...profile,
        education: [...profile.education, newEducation]
      }
    })
  },
  
  // Update education
  updateEducation: (id, updates) => {
    const { profile } = get()
    if (!profile) return
    
    set({
      profile: {
        ...profile,
        education: profile.education.map(edu =>
          edu.id === id ? { ...edu, ...updates } : edu
        )
      }
    })
  },
  
  // Delete education
  deleteEducation: (id) => {
    const { profile } = get()
    if (!profile) return
    
    set({
      profile: {
        ...profile,
        education: profile.education.filter(edu => edu.id !== id)
      }
    })
  },
  
  // Add skill
  addSkill: (skill) => {
    const { profile } = get()
    if (!profile) return
    
    // Prevent duplicates
    const exists = profile.skills.some(s => s.name.toLowerCase() === skill.name.toLowerCase())
    if (exists) return
    
    set({
      profile: {
        ...profile,
        skills: [...profile.skills, skill]
      }
    })
  },
  
  // Delete skill
  deleteSkill: (skillName) => {
    const { profile } = get()
    if (!profile) return
    
    set({
      profile: {
        ...profile,
        skills: profile.skills.filter(s => s.name !== skillName)
      }
    })
  },
  
  // Set role preference
  setRolePreference: (role) => {
    const { profile } = get()
    if (!profile) return
    
    set({
      profile: {
        ...profile,
        rolePreference: role
      }
    })
  },
  
  // Update domain extras
  updateDomainExtras: (updates) => {
    const { profile } = get()
    if (!profile) return
    
    set({
      profile: {
        ...profile,
        domainExtras: { ...profile.domainExtras, ...updates }
      }
    })
  },
  
  // Reset profile
  resetProfile: () => {
    set({
      profile: null,
      confidenceScores: [],
      error: null,
      lastSaved: null
    })
  }
}))
```

Add comprehensive JSDoc explaining store actions and integration with parser/storage.
  </action>
  <verify>
Run `pnpm type-check` - must pass.
Test manually: call useProfileStore actions in a test component - verify state updates.
  </verify>
  <done>
Profile store exported with useProfileStore hook. Integrates parser and storage. All CRUD actions for work/education/skills implemented.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Profile Editor Components</name>
  <files>src/components/ProfileEditor.tsx, src/components/WorkExperienceEditor.tsx, src/components/EducationEditor.tsx, src/components/SkillsEditor.tsx</files>
  <action>
Create React components for profile editing (REQ-PRO-02):

**Due to length constraints, I'll provide the structure and key implementation details. Each component should:**

**src/components/ProfileEditor.tsx** - Main profile editor with tabs:
- Resume paste textarea with "Parse Resume" button
- Tabs: Personal Info, Work Experience, Education, Skills, Role & Extras
- Save button (calls useProfileStore saveProfile)
- Loading/saving states with spinners
- Error messages display
- Confidence score badges (green/yellow/red) for low-confidence fields

**src/components/WorkExperienceEditor.tsx** - Work history CRUD:
- List of work experiences (position, company, dates)
- "Add Experience" button opens form
- Edit button per entry
- Delete button per entry (with confirmation)
- Form fields: position, company, startDate, endDate (or "Present"), achievements (textarea, converts to bullet array)

**src/components/EducationEditor.tsx** - Education CRUD:
- List of education entries (degree, institution, dates)
- Similar CRUD pattern as WorkExperienceEditor
- Form fields: degree, institution, startDate, endDate, GPA (optional)

**src/components/SkillsEditor.tsx** - Skills management:
- Tag-based UI (pills/badges)
- Add skill input (press Enter to add)
- Remove skill (X button on each tag)
- Skills list displayed as colored tags

**Styling:** Use Tailwind CSS classes from Phase 0. Match design from popup/options pages. Use:
- `bg-gradient-to-br from-blue-500 to-purple-600` for headers
- `shadow-lg rounded-lg` for cards
- `hover:shadow-xl transition-shadow` for interactive elements
- `text-sm font-medium` for labels

**Key implementation patterns:**
```typescript
// Example: WorkExperienceEditor.tsx structure
import React, { useState } from 'react'
import { useProfileStore } from '@/lib/store/profile-store'
import type { WorkExperience } from '@/types/profile'

export function WorkExperienceEditor() {
  const { profile, addWorkExperience, updateWorkExperience, deleteWorkExperience } = useProfileStore()
  const [isAdding, setIsAdding] = useState(false)
  const [editingId, setEditingId] = useState<string | null>(null)
  
  // Form state for new/editing experience
  const [formData, setFormData] = useState<Partial<WorkExperience>>({})
  
  const handleAdd = () => {
    addWorkExperience(formData as Omit<WorkExperience, 'id'>)
    setFormData({})
    setIsAdding(false)
  }
  
  const handleUpdate = (id: string) => {
    updateWorkExperience(id, formData)
    setFormData({})
    setEditingId(null)
  }
  
  const handleDelete = (id: string) => {
    if (confirm('Delete this work experience?')) {
      deleteWorkExperience(id)
    }
  }
  
  return (
    <div className="space-y-4">
      <div className="flex justify-between items-center">
        <h3 className="text-lg font-semibold">Work Experience</h3>
        <button 
          onClick={() => setIsAdding(true)}
          className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
        >
          Add Experience
        </button>
      </div>
      
      {/* List existing experiences */}
      <div className="space-y-3">
        {profile?.workHistory.map(exp => (
          <div key={exp.id} className="p-4 border rounded-lg">
            {/* Display or edit form */}
          </div>
        ))}
      </div>
      
      {/* Add new form modal/inline */}
      {isAdding && (
        <div className="p-4 border-2 border-blue-500 rounded-lg">
          {/* Form fields */}
        </div>
      )}
    </div>
  )
}
```

Apply similar patterns to EducationEditor and SkillsEditor.
  </action>
  <verify>
Run `pnpm type-check` - must pass.
Run `pnpm dev` - load extension, open options page, verify components render without errors.
  </verify>
  <done>
Profile editor components created: ProfileEditor, WorkExperienceEditor, EducationEditor, SkillsEditor. All use useProfileStore and Tailwind styling.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate Profile Editor into Options Page</name>
  <files>src/entrypoints/options/App.tsx</files>
  <action>
Update `src/entrypoints/options/App.tsx` to include ProfileEditor:

```typescript
import React, { useEffect } from 'react'
import { useProfileStore } from '@/lib/store/profile-store'
import { ProfileEditor } from '@/components/ProfileEditor'

export default function App() {
  const { loadProfile, isLoading } = useProfileStore()
  
  // Load profile on mount
  useEffect(() => {
    loadProfile()
  }, [loadProfile])
  
  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">Loading profile...</p>
        </div>
      </div>
    )
  }
  
  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-4xl mx-auto px-4">
        <header className="mb-8">
          <h1 className="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
            AutoApply Copilot
          </h1>
          <p className="text-gray-600 mt-2">
            Profile Management & Settings
          </p>
        </header>
        
        <ProfileEditor />
      </div>
    </div>
  )
}
```

Add navigation tabs if time permits: Profile, Settings, Data Export, About.
  </action>
  <verify>
Run `pnpm dev` - load extension in Chrome, open options page (right-click extension icon â†’ Options), verify ProfileEditor renders and functions correctly.
  </verify>
  <done>
Options page updated with ProfileEditor integration. Profile loads on mount. UI styled with Tailwind matching extension design.
  </done>
</task>

<task type="auto">
  <name>Task 4: Create Store Unit Tests</name>
  <files>tests/unit/store/profile-store.test.ts</files>
  <action>
Update `tests/unit/store/profile-store.test.ts` with comprehensive store tests:

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { useProfileStore } from '@/lib/store/profile-store'
import type { Profile, WorkExperience } from '@/types/profile'

// Mock storage and parser
vi.mock('@/lib/storage/profile-storage', () => ({
  saveProfile: vi.fn().mockResolvedValue(undefined),
  loadProfile: vi.fn().mockResolvedValue(null)
}))

vi.mock('@/lib/parser/resume-parser', () => ({
  parseResume: vi.fn().mockResolvedValue({
    success: true,
    data: {
      profile: {
        personal: { name: 'Test User', email: 'test@example.com' },
        workHistory: [],
        education: [],
        skills: []
      },
      confidenceScores: [],
      parseErrors: [],
      unparsedText: []
    }
  })
}))

describe('useProfileStore', () => {
  beforeEach(() => {
    // Reset store state
    useProfileStore.setState({
      profile: null,
      confidenceScores: [],
      isLoading: false,
      isSaving: false,
      isParsing: false,
      error: null,
      lastSaved: null
    })
  })
  
  describe('work experience actions', () => {
    it('should add work experience', () => {
      const store = useProfileStore.getState()
      
      // Set up initial profile
      store.resetProfile()
      // ... test addWorkExperience action
    })
    
    it('should update work experience', () => {
      // ... test updateWorkExperience action
    })
    
    it('should delete work experience', () => {
      // ... test deleteWorkExperience action
    })
  })
  
  describe('education actions', () => {
    // Similar tests for education CRUD
  })
  
  describe('skills actions', () => {
    it('should add skill', () => {
      // ... test addSkill action
    })
    
    it('should prevent duplicate skills', () => {
      // ... test duplicate prevention
    })
    
    it('should delete skill', () => {
      // ... test deleteSkill action
    })
  })
  
  describe('parseResume action', () => {
    it('should parse resume and update profile', async () => {
      const store = useProfileStore.getState()
      
      await store.parseResume('Sample resume text...')
      
      expect(store.profile).toBeTruthy()
      expect(store.profile?.personal.name).toBe('Test User')
    })
  })
})
```

Add tests for all store actions covering REQ-PRO-02 acceptance criteria.
  </action>
  <verify>
Run `pnpm test` - all store tests must pass.
Verify coverage includes CRUD operations for work/education/skills.
  </verify>
  <done>
Store tests passing with coverage for all CRUD actions. Tests verify add/edit/delete functionality per REQ-PRO-02.
  </done>
</task>

</tasks>

<verification>
**UI Functionality:**
- [ ] Profile editor renders in options page
- [ ] Resume paste + parse button works
- [ ] Add/edit/delete work experience functional
- [ ] Add/edit/delete education functional
- [ ] Add/delete skills functional
- [ ] Role preference selector works
- [ ] Save button persists to encrypted storage
- [ ] Profile reloads after browser restart

**Code Quality:**
- [ ] `pnpm type-check` passes
- [ ] `pnpm test` passes with all store tests
- [ ] `pnpm dev` - extension loads without errors
- [ ] Options page accessible and functional

**Requirements Coverage:**
- [ ] REQ-PRO-02: Profile editor UI implemented and functional
- [ ] REQ-PRO-03: Role preference selection implemented
- [ ] REQ-PRO-04: Domain-specific fields visible per role (stretch - can be P1 for next plan if time)
</verification>

<success_criteria>
- Profile editor fully functional in extension options page
- User can paste resume and see parsed data
- User can manually add/edit/delete work history entries
- User can manually add/edit/delete education entries
- User can add/remove skills
- User can select role preference
- Profile saves encrypted and persists across sessions
- All components styled with Tailwind CSS
- Zustand store tested with unit tests
- Integration with parser (Plan 02) and storage (Plan 03) working
</success_criteria>

<output>
After completion, create `.planning/phases/01-profile-management-resume-parsing/01-04-SUMMARY.md` following the standard summary template.
</output>
