---
phase: 02-ats-detection-autofill
plan: 06
type: execute
wave: 6
depends_on: ['02-05']
files_modified:
  - src/entrypoints/content/helper-mode.content/index.tsx
  - src/entrypoints/content/helper-mode.content/HelperSidebar.tsx
  - src/entrypoints/content/helper-mode.content/style.css
  - src/lib/ui/clipboard-utils.ts
  - src/components/ProfileSnippet.tsx
autonomous: true

must_haves:
  truths:
    - "Helper Mode activates on unsupported sites or low-confidence detection"
    - "Sidebar shows copyable profile sections"
    - "User can switch between Autofill and Helper modes"
    - "Copy-to-clipboard works for all profile fields"
  artifacts:
    - path: "src/entrypoints/content/helper-mode.content/index.tsx"
      provides: "Content script for Helper Mode UI"
      exports: []
      min_lines: 100
    - path: "src/entrypoints/content/helper-mode.content/HelperSidebar.tsx"
      provides: "Helper Mode sidebar component"
      exports: ["HelperSidebar"]
      min_lines: 200
    - path: "src/entrypoints/content/helper-mode.content/style.css"
      provides: "Shadow DOM styles for Helper Mode"
      exports: []
      min_lines: 80
    - path: "src/lib/ui/clipboard-utils.ts"
      provides: "Copy-to-clipboard utilities"
      exports: ["copyToClipboard", "copyWithFeedback"]
      min_lines: 50
    - path: "src/components/ProfileSnippet.tsx"
      provides: "Copyable profile section component"
      exports: ["ProfileSnippet"]
      min_lines: 100
  key_links:
    - from: "src/entrypoints/content/helper-mode.content/HelperSidebar.tsx"
      to: "@/types/profile"
      via: "Displays Profile data"
      pattern: "Profile"
    - from: "src/lib/ui/clipboard-utils.ts"
      to: "Clipboard API"
      via: "Uses navigator.clipboard"
      pattern: "clipboard"
---

<objective>
Build Helper Mode sidebar for unsupported sites with copy-to-clipboard functionality and mode switching.

**Purpose:** Provide fallback UI for unsupported ATS platforms or low-confidence detection. Displays collapsible sidebar with profile sections that user can copy-paste manually. Supports bidirectional switching between Autofill and Helper modes (REQ-ATS-17, REQ-ATS-18, REQ-ATS-19, REQ-ATS-20).

**Output:** Fully functional Helper Mode sidebar with copyable profile snippets, graceful degradation, and mode switching.
</objective>

<execution_context>
@C:/Users/kittu/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/kittu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-ats-detection-autofill/02-00-OVERVIEW.md
@.planning/phases/02-ats-detection-autofill/02-01-PLAN.md
@.planning/phases/02-ats-detection-autofill/02-02-PLAN.md
@.planning/phases/02-ats-detection-autofill/02-03-PLAN.md
@.planning/phases/02-ats-detection-autofill/02-04-PLAN.md
@.planning/phases/02-ats-detection-autofill/02-05-PLAN.md
@TECHSTACK.md
@AGENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Clipboard Utilities</name>
  <files>src/lib/ui/clipboard-utils.ts</files>
  <action>
Create `src/lib/ui/clipboard-utils.ts` for copy-to-clipboard functionality:

```typescript
/**
 * Copy text to clipboard using Clipboard API
 * Falls back to document.execCommand if Clipboard API not available
 *
 * @param text - Text to copy
 * @returns Promise resolving to true if successful
 */
export async function copyToClipboard(text: string): Promise<boolean> {
  try {
    // Try modern Clipboard API first
    if (navigator.clipboard && window.isSecureContext) {
      await navigator.clipboard.writeText(text);
      console.log('[Clipboard] Copied using Clipboard API');
      return true;
    }

    // Fallback to execCommand
    return copyWithExecCommand(text);
  } catch (error) {
    console.error('[Clipboard] Copy failed:', error);
    return false;
  }
}

/**
 * Copy text with visual feedback
 * Returns promise that resolves after feedback animation
 */
export async function copyWithFeedback(
  text: string,
  onSuccess?: () => void,
  onError?: () => void
): Promise<boolean> {
  const success = await copyToClipboard(text);

  if (success) {
    onSuccess?.();
  } else {
    onError?.();
  }

  return success;
}

/**
 * Fallback copy method using execCommand (deprecated but widely supported)
 */
function copyWithExecCommand(text: string): boolean {
  const textarea = document.createElement('textarea');
  textarea.value = text;
  textarea.style.position = 'fixed';
  textarea.style.top = '0';
  textarea.style.left = '0';
  textarea.style.opacity = '0';
  textarea.style.pointerEvents = 'none';

  document.body.appendChild(textarea);
  textarea.focus();
  textarea.select();

  try {
    const successful = document.execCommand('copy');
    document.body.removeChild(textarea);
    console.log('[Clipboard] Copied using execCommand:', successful);
    return successful;
  } catch (error) {
    document.body.removeChild(textarea);
    console.error('[Clipboard] execCommand failed:', error);
    return false;
  }
}

/**
 * Check if Clipboard API is available
 */
export function isClipboardAvailable(): boolean {
  return !!(navigator.clipboard && window.isSecureContext);
}

/**
 * Format profile data for copy
 */
export function formatForCopy(data: any): string {
  if (Array.isArray(data)) {
    return data.map((item) => {
      if (typeof item === 'object') {
        return Object.values(item).join(' | ');
      }
      return String(item);
    }).join('\n');
  }

  if (typeof data === 'object' && data !== null) {
    return Object.entries(data)
      .map(([key, value]) => `${key}: ${value}`)
      .join('\n');
  }

  return String(data);
}
```

**Commit:** `feat(02-06): create clipboard utilities`
  </action>
</task>

<task type="auto">
  <name>Task 2: Create Profile Snippet Component</name>
  <files>src/components/ProfileSnippet.tsx</files>
  <action>
Create `src/components/ProfileSnippet.tsx` for copyable profile sections:

```typescript
import React, { useState } from 'react';
import { copyWithFeedback, formatForCopy } from '@/lib/ui/clipboard-utils';

export interface ProfileSnippetProps {
  /** Section title */
  title: string;
  /** Section data */
  data: any;
  /** Icon (optional) */
  icon?: string;
  /** Is section expanded by default? */
  defaultExpanded?: boolean;
}

/**
 * Copyable profile section component
 * Displays profile data with copy-to-clipboard button
 */
export function ProfileSnippet({
  title,
  data,
  icon,
  defaultExpanded = false,
}: ProfileSnippetProps) {
  const [expanded, setExpanded] = useState(defaultExpanded);
  const [copied, setCopied] = useState(false);

  const handleCopy = async () => {
    const text = formatForCopy(data);
    const success = await copyWithFeedback(
      text,
      () => {
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      },
      () => {
        console.error('Failed to copy');
      }
    );
  };

  const renderValue = (value: any): React.ReactNode => {
    if (Array.isArray(value)) {
      return (
        <ul className="list-disc list-inside space-y-1">
          {value.map((item, index) => (
            <li key={index} className="text-sm text-gray-700">
              {typeof item === 'object' ? JSON.stringify(item, null, 2) : String(item)}
            </li>
          ))}
        </ul>
      );
    }

    if (typeof value === 'object' && value !== null) {
      return (
        <div className="space-y-1">
          {Object.entries(value).map(([key, val]) => (
            <div key={key} className="text-sm">
              <span className="font-medium text-gray-600">{key}:</span>{' '}
              <span className="text-gray-700">{String(val)}</span>
            </div>
          ))}
        </div>
      );
    }

    return <p className="text-sm text-gray-700 whitespace-pre-wrap">{String(value)}</p>;
  };

  return (
    <div className="border border-gray-200 rounded-lg overflow-hidden bg-white">
      <div
        className="flex items-center justify-between p-3 cursor-pointer hover:bg-gray-50 transition-colors"
        onClick={() => setExpanded(!expanded)}
      >
        <div className="flex items-center gap-2">
          {icon && <span className="text-lg">{icon}</span>}
          <h3 className="font-semibold text-sm text-gray-900">{title}</h3>
        </div>
        <div className="flex items-center gap-2">
          <button
            onClick={(e) => {
              e.stopPropagation();
              handleCopy();
            }}
            className={`
              px-2 py-1 text-xs rounded font-medium transition-colors
              ${
                copied
                  ? 'bg-green-100 text-green-700'
                  : 'bg-indigo-100 text-indigo-700 hover:bg-indigo-200'
              }
            `}
          >
            {copied ? 'âœ“ Copied' : 'Copy'}
          </button>
          <span className="text-gray-400">
            {expanded ? 'â–¼' : 'â–¶'}
          </span>
        </div>
      </div>

      {expanded && (
        <div className="p-3 border-t border-gray-200 bg-gray-50">
          {renderValue(data)}
        </div>
      )}
    </div>
  );
}
```

**Commit:** `feat(02-06): create profile snippet component`
  </action>
</task>

<task type="auto">
  <name>Task 3: Create Helper Sidebar Component</name>
  <files>src/entrypoints/content/helper-mode.content/HelperSidebar.tsx</files>
  <action>
Create `src/entrypoints/content/helper-mode.content/HelperSidebar.tsx`:

```typescript
import React, { useState } from 'react';
import { ProfileSnippet } from '@/components/ProfileSnippet';
import type { Profile } from '@/types/profile';
import type { DetectionResult } from '@/types/ats';

export interface HelperSidebarProps {
  profile: Profile;
  detection: DetectionResult | null;
  onSwitchToAutofill?: () => void;
}

type SidebarState = 'collapsed' | 'expanded';

/**
 * Helper Mode sidebar
 * Displays copyable profile sections for manual filling
 */
export function HelperSidebar({ profile, detection, onSwitchToAutofill }: HelperSidebarProps) {
  const [state, setState] = useState<SidebarState>('expanded');

  const toggleState = () => {
    setState(state === 'collapsed' ? 'expanded' : 'collapsed');
  };

  const canSwitchToAutofill =
    detection && detection.platform && detection.confidence >= 50;

  return (
    <div
      className={`
        fixed top-0 right-0 h-full bg-white shadow-2xl z-[10000]
        transition-transform duration-300 ease-in-out
        ${state === 'collapsed' ? 'translate-x-full' : 'translate-x-0'}
      `}
      style={{ width: '360px' }}
    >
      {/* Toggle button */}
      <button
        onClick={toggleState}
        className="absolute -left-10 top-4 w-10 h-10 bg-indigo-600 text-white rounded-l-lg shadow-lg hover:bg-indigo-700 transition-colors flex items-center justify-center"
        title={state === 'collapsed' ? 'Open Helper' : 'Close Helper'}
      >
        {state === 'collapsed' ? 'â—€' : 'â–¶'}
      </button>

      {/* Sidebar content */}
      <div className="h-full flex flex-col">
        {/* Header */}
        <div className="bg-indigo-600 text-white p-4">
          <h2 className="text-lg font-bold">AutoApply Helper</h2>
          <p className="text-sm text-indigo-100 mt-1">
            Copy sections to fill the form manually
          </p>

          {/* Detection info */}
          {detection && (
            <div className="mt-3 p-2 bg-indigo-700 rounded text-xs">
              <div className="flex items-center justify-between">
                <span>Detection:</span>
                <span className="font-semibold">
                  {detection.platform || 'Unknown'}
                </span>
              </div>
              <div className="flex items-center justify-between mt-1">
                <span>Confidence:</span>
                <span className="font-semibold">{detection.confidence}%</span>
              </div>
            </div>
          )}

          {/* Switch to autofill button */}
          {canSwitchToAutofill && onSwitchToAutofill && (
            <button
              onClick={onSwitchToAutofill}
              className="w-full mt-3 px-3 py-2 bg-white text-indigo-600 rounded font-semibold text-sm hover:bg-indigo-50 transition-colors"
            >
              Switch to Autofill Mode
            </button>
          )}
        </div>

        {/* Scrollable content */}
        <div className="flex-1 overflow-y-auto p-4 space-y-3">
          {/* Contact Info */}
          <ProfileSnippet
            title="Contact Info"
            icon="ðŸ“§"
            data={{
              Name: `${profile.firstName} ${profile.lastName}`,
              Email: profile.email,
              Phone: profile.phone,
            }}
            defaultExpanded
          />

          {/* Location */}
          {(profile.address || profile.city || profile.state) && (
            <ProfileSnippet
              title="Location"
              icon="ðŸ“"
              data={{
                Address: profile.address,
                City: profile.city,
                State: profile.state,
                Zip: profile.zipCode,
                Country: profile.country,
              }}
            />
          )}

          {/* Links */}
          {(profile.linkedinUrl || profile.githubUrl || profile.portfolioUrl) && (
            <ProfileSnippet
              title="Professional Links"
              icon="ðŸ”—"
              data={{
                LinkedIn: profile.linkedinUrl,
                GitHub: profile.githubUrl,
                Portfolio: profile.portfolioUrl,
              }}
            />
          )}

          {/* Current Position */}
          {(profile.currentCompany || profile.currentTitle) && (
            <ProfileSnippet
              title="Current Position"
              icon="ðŸ’¼"
              data={{
                Company: profile.currentCompany,
                Title: profile.currentTitle,
                Experience: profile.yearsOfExperience
                  ? `${profile.yearsOfExperience} years`
                  : null,
              }}
            />
          )}

          {/* Work History */}
          {profile.workHistory && profile.workHistory.length > 0 && (
            <ProfileSnippet
              title="Work History"
              icon="ðŸ“‹"
              data={profile.workHistory}
            />
          )}

          {/* Education */}
          {profile.education && profile.education.length > 0 && (
            <ProfileSnippet
              title="Education"
              icon="ðŸŽ“"
              data={profile.education}
            />
          )}

          {/* Skills */}
          {profile.skills && profile.skills.length > 0 && (
            <ProfileSnippet
              title="Skills"
              icon="âš¡"
              data={profile.skills}
            />
          )}
        </div>

        {/* Footer */}
        <div className="border-t border-gray-200 p-4 bg-gray-50">
          <p className="text-xs text-gray-600 text-center">
            Click any section to expand/collapse
            <br />
            Click "Copy" to copy to clipboard
          </p>
        </div>
      </div>
    </div>
  );
}
```

**Commit:** `feat(02-06): create helper mode sidebar component`
  </action>
</task>

<task type="auto">
  <name>Task 4: Create Helper Mode Content Script</name>
  <files>src/entrypoints/content/helper-mode.content/index.tsx</files>
  <action>
Create `src/entrypoints/content/helper-mode.content/index.tsx`:

```typescript
import { defineContentScript } from 'wxt/sandbox';
import ReactDOM from 'react-dom/client';
import React from 'react';
import { HelperSidebar } from './HelperSidebar';
import type { Profile } from '@/types/profile';
import type { DetectionResult } from '@/types/ats';
import './style.css';

export default defineContentScript({
  matches: ['<all_urls>'],

  main() {
    console.log('[Helper Mode] Content script loaded');

    let sidebarContainer: HTMLElement | null = null;
    let reactRoot: ReactDOM.Root | null = null;

    /**
     * Initialize Helper Mode sidebar
     */
    async function initHelperMode(detection: DetectionResult | null) {
      // Get user profile
      const { profile } = await chrome.storage.local.get('profile');
      if (!profile) {
        console.log('[Helper Mode] No profile found');
        return;
      }

      // Create sidebar container with Shadow DOM
      sidebarContainer = document.createElement('div');
      sidebarContainer.id = 'autoapply-helper-root';
      document.body.appendChild(sidebarContainer);

      // Attach Shadow DOM
      const shadowRoot = sidebarContainer.attachShadow({ mode: 'open' });

      // Add Tailwind styles to Shadow DOM
      const style = document.createElement('style');
      style.textContent = `@import "${chrome.runtime.getURL('content-scripts/helper-mode.css')}";`;
      shadowRoot.appendChild(style);

      // Create React root in Shadow DOM
      const reactContainer = document.createElement('div');
      shadowRoot.appendChild(reactContainer);

      // Render sidebar
      reactRoot = ReactDOM.createRoot(reactContainer);
      reactRoot.render(
        <React.StrictMode>
          <HelperSidebar
            profile={profile as Profile}
            detection={detection}
            onSwitchToAutofill={() => {
              // Emit event to switch to autofill mode
              window.dispatchEvent(
                new CustomEvent('autoapply:switch-to-autofill', {
                  detail: detection,
                })
              );
              cleanup();
            }}
          />
        </React.StrictMode>
      );

      console.log('[Helper Mode] Sidebar initialized');
    }

    /**
     * Cleanup sidebar
     */
    function cleanup() {
      if (reactRoot) {
        reactRoot.unmount();
        reactRoot = null;
      }

      if (sidebarContainer) {
        sidebarContainer.remove();
        sidebarContainer = null;
      }
    }

    /**
     * Determine if Helper Mode should activate
     */
    function shouldActivateHelperMode(detection: DetectionResult | null): boolean {
      // No detection or null platform
      if (!detection || !detection.platform) {
        return true;
      }

      // Low confidence detection (50-70%)
      if (detection.confidence < 70) {
        return true;
      }

      // High confidence - don't activate Helper Mode
      return false;
    }

    // Listen for ATS detection events
    window.addEventListener('autoapply:ats-detected', ((event: CustomEvent) => {
      const detection = event.detail as DetectionResult;
      console.log('[Helper Mode] Detection received:', detection);

      cleanup();

      // Activate Helper Mode if detection is low confidence or unsupported
      if (shouldActivateHelperMode(detection)) {
        console.log('[Helper Mode] Activating Helper Mode');
        initHelperMode(detection);
      }
    }) as EventListener);

    // Listen for manual activation (user clicks extension icon)
    chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
      if (message.type === 'ACTIVATE_HELPER_MODE') {
        console.log('[Helper Mode] Manual activation');
        cleanup();
        initHelperMode(message.detection || null);
        sendResponse({ success: true });
      }

      if (message.type === 'DEACTIVATE_HELPER_MODE') {
        console.log('[Helper Mode] Deactivation');
        cleanup();
        sendResponse({ success: true });
      }

      return true;
    });

    // Cleanup on unload
    window.addEventListener('beforeunload', cleanup);
  },
});
```

**Commit:** `feat(02-06): create helper mode content script`
  </action>
</task>

<task type="auto">
  <name>Task 5: Create Helper Mode Styles</name>
  <files>src/entrypoints/content/helper-mode.content/style.css</files>
  <action>
Create `src/entrypoints/content/helper-mode.content/style.css`:

```css
/* Shadow DOM styles for Helper Mode sidebar */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Reset default styles */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* Sidebar animations */
@keyframes slideIn {
  from {
    transform: translateX(100%);
  }
  to {
    transform: translateX(0);
  }
}

@keyframes slideOut {
  from {
    transform: translateX(0);
  }
  to {
    transform: translateX(100%);
  }
}

.animate-slide-in {
  animation: slideIn 0.3s ease-out;
}

.animate-slide-out {
  animation: slideOut 0.3s ease-out;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: #f1f5f9;
}

::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #94a3b8;
}

/* Button focus styles */
button:focus {
  outline: 2px solid #6366f1;
  outline-offset: 2px;
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Profile snippet copy feedback */
.copy-success {
  animation: pulse 0.5s ease-in-out;
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}
```

**Commit:** `feat(02-06): create helper mode styles`
  </action>
</task>

<task type="auto">
  <name>Task 6: Update Background Script for Helper Mode</name>
  <files>src/entrypoints/background.ts</files>
  <action>
Update `src/entrypoints/background.ts` to handle Helper Mode activation:

Add the following to the message listener:

```typescript
// In chrome.runtime.onMessage.addListener

if (message.type === 'TOGGLE_HELPER_MODE') {
  // Send message to active tab to toggle Helper Mode
  const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
  if (tab.id) {
    await chrome.tabs.sendMessage(tab.id, {
      type: message.activate ? 'ACTIVATE_HELPER_MODE' : 'DEACTIVATE_HELPER_MODE',
      detection: message.detection,
    });
  }
  sendResponse({ success: true });
}
```

**Commit:** `feat(02-06): update background script for helper mode`
  </action>
</task>

</tasks>

<verification>
- [ ] Helper Mode sidebar appears on unsupported sites
- [ ] Helper Mode activates when detection confidence <70%
- [ ] Sidebar is collapsible (toggle button works)
- [ ] Profile sections are copyable (copy button works)
- [ ] Clipboard API works (or falls back to execCommand)
- [ ] Copy feedback shows (button changes to "âœ“ Copied")
- [ ] Switch to Autofill button works (when detection â‰¥50%)
- [ ] Sidebar uses Shadow DOM (styles isolated)
- [ ] Scrolling works for long profiles
- [ ] Manual activation via extension popup works
</verification>

<success_criteria>
- âœ… Helper Mode sidebar component with React
- âœ… Copyable profile snippets with visual feedback
- âœ… Copy-to-clipboard with Clipboard API + execCommand fallback
- âœ… Graceful degradation for unsupported sites
- âœ… Low-confidence detection handling (50-70%)
- âœ… Bidirectional mode switching (Autofill â†” Helper)
- âœ… Shadow DOM isolation for styles
- âœ… Collapsible sidebar with smooth animation
- âœ… Manual activation support
</success_criteria>

<next_steps>
After completing this plan:
1. Test Helper Mode on unsupported sites
2. Test low-confidence detection (50-70%)
3. Verify copy-to-clipboard on different browsers
4. Test mode switching from Helper â†’ Autofill
5. Phase 2 complete! Move to Phase 3 (AI Answer Generation)
</next_steps>

---

*Plan: 02-06-Helper-Mode*
*Priority: P1*
*Duration: 60 minutes*
