---
phase: 04-job-tracker-safety
plan: 08
type: checkpoint:human-verify
wave: 1
depends_on: []
files_modified: []
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "Workday submission logging verified on live platform"
    - "Greenhouse submission logging verified on live platform"
    - "Lever submission logging verified on live platform"
    - "CAPTCHA detection blocks logging on all 3 platforms"
    - "Volume count increments correctly after each submission"
    - "Per-job disable toggle prevents logging when enabled"
  artifacts: []
  key_links:
    - from: "src/entrypoints/content/submission-logger.ts"
      to: "Live ATS platforms"
      via: "Hybrid submission detection"
      pattern: "handleFormSubmit|handleURLChange"
    - from: "src/lib/tracker/storage.ts"
      to: "Chrome Storage"
      via: "Application persistence"
      pattern: "saveApplication|getApplications"
    - from: "src/lib/safety/volume-limiter.ts"
      to: "Chrome Storage"
      via: "Volume count increment"
      pattern: "incrementVolume|getVolumeData"
---

<objective>
Manual E2E testing to verify submission logging works correctly on all 3 ATS platforms with safety controls.

Purpose: Verify submission logger, CAPTCHA detection, volume tracking, and per-job disable work in production
Output: Verified Phase 4 functionality on live ATS platforms
</objective>

<execution_context>
@C:/Users/kittu/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/kittu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-job-tracker-safety/04-01-SUMMARY.md
@.planning/phases/04-job-tracker-safety/04-02-SUMMARY.md
@.planning/phases/04-job-tracker-safety/04-03-SUMMARY.md
@.planning/phases/04-job-tracker-safety/04-05-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Automatic submission logging system with:
- Hybrid detection (form submit + URL change confirmation)
- CAPTCHA blocking integration
- Volume tracking with calendar day reset
- Per-job disable toggle
  </what-built>
  
  <how-to-verify>

## Pre-Test Setup

1. **Build extension:**
```bash
pnpm build
```

2. **Load in Chrome:**
- Open `chrome://extensions/`
- Enable "Developer mode"
- Click "Load unpacked"
- Select `.output/chrome-mv3` directory

3. **Verify extension loaded:**
- Extension icon appears in toolbar
- Click icon to open popup
- Verify "Tracker" tab exists

4. **Clear existing data (fresh start):**
```bash
# Open popup -> Tracker tab
# If any applications exist, delete them all
# Verify volume count is 0
```

---

## Test 1: Workday Submission Logging (P0 BLOCKER)

**Objective:** Verify submission detection and logging on Workday platform

**Steps:**

1. Find a live Workday job posting:
   - Search Google: "site:myworkdayjobs.com software engineer"
   - Open any Workday job application page
   - URL should contain `myworkdayjobs.com`

2. Verify ATS detection:
   - Open browser DevTools → Console
   - Look for `[Submission Logger] Initializing hybrid submission detection`
   - If not present, refresh page

3. Fill application form:
   - Use autofill button from Phase 2 OR fill manually
   - Complete required fields (name, email, resume upload)
   - **DO NOT submit yet**

4. Check for CAPTCHA:
   - Look for reCAPTCHA/hCaptcha on page
   - If CAPTCHA present:
     - Extension badge should show ⚠️ (orange)
     - Verify in console: `[CAPTCHA Detector] CAPTCHA detected`
   - If NO CAPTCHA:
     - Badge should be clear
     - Proceed to next step

5. Submit application:
   - Click "Submit Application" button
   - Wait for redirect to confirmation/success page
   - URL should change to pattern like `/submitted` or `/thank-you`

6. Verify logging in console:
   - Look for: `[Submission Logger] Form submit detected`
   - Look for: `[Submission Logger] URL change detected`
   - Look for: `[Submission Logger] ✅ Application logged: [Job Title] at [Company]`

7. Check tracker in popup:
   - Open extension popup → Tracker tab
   - Verify 1 application appears
   - Verify job title matches (or "Unknown Position" if extraction failed)
   - Verify company name matches (or "Unknown Company" if extraction failed)
   - Verify status is "Applied"
   - Verify date is today
   - Verify ATS type is "Workday"

8. Check volume count:
   - Volume should show 1 application today
   - Should NOT show warning (threshold is 15)

**Expected Results:**
- ✅ Application logged automatically
- ✅ Job title extracted correctly (or fallback "Unknown Position")
- ✅ Company name extracted correctly (or fallback "Unknown Company")
- ✅ Status set to "Applied"
- ✅ Date is today's date
- ✅ ATS type is "workday"
- ✅ Volume count incremented to 1

**If CAPTCHA was present:**
- ✅ NO logging occurred while CAPTCHA visible
- ✅ Extension badge showed ⚠️ warning
- ✅ After CAPTCHA solved, logging worked normally

---

## Test 2: Greenhouse Submission Logging (P0 BLOCKER)

**Objective:** Verify submission detection and logging on Greenhouse platform

**Steps:**

1. Find a live Greenhouse job posting:
   - Search Google: "site:greenhouse.io careers"
   - Open any Greenhouse job application page
   - URL should contain `greenhouse.io` or `/embed/job_app`

2. Verify ATS detection:
   - Open browser DevTools → Console
   - Look for `[Submission Logger] Initializing hybrid submission detection`

3. Fill and submit application:
   - Complete form (name, email, resume)
   - Check for CAPTCHA (if present, verify badge shows ⚠️)
   - Submit application
   - Wait for confirmation page

4. Verify logging:
   - Check console for `✅ Application logged`
   - Open popup → Tracker tab
   - Verify 2 applications total (Workday + Greenhouse)
   - Verify new application has ATS type "Greenhouse"

5. Check volume count:
   - Volume should show 2 applications today
   - Should NOT show warning yet (threshold is 15)

**Expected Results:**
- ✅ Application logged automatically
- ✅ ATS type is "greenhouse"
- ✅ Volume count incremented to 2

---

## Test 3: Lever Submission Logging (P0 BLOCKER)

**Objective:** Verify submission detection and logging on Lever platform

**Steps:**

1. Find a live Lever job posting:
   - Search Google: "site:lever.co jobs apply"
   - Open any Lever job application page
   - URL should contain `lever.co` or `/apply/`

2. Verify ATS detection and submit:
   - Same process as Workday/Greenhouse
   - Fill form, check CAPTCHA, submit

3. Verify logging:
   - Check console for `✅ Application logged`
   - Open popup → Tracker tab
   - Verify 3 applications total
   - Verify new application has ATS type "Lever"

4. Check volume count:
   - Volume should show 3 applications today

**Expected Results:**
- ✅ Application logged automatically
- ✅ ATS type is "lever"
- ✅ Volume count incremented to 3

---

## Test 4: Volume Warning (P1 SHOULD-FIX)

**Objective:** Verify volume warning appears at 15 apps/day threshold

**Steps:**

1. **Manually add 12 more applications** to reach 15 total:
   - This test is manual due to rate limiting concerns
   - Alternative: Use Chrome DevTools to manually insert test data

   ```javascript
   // Open popup → DevTools → Console
   // Run this script to add 12 mock applications:
   
   for (let i = 0; i < 12; i++) {
     chrome.storage.local.get('applications', (data) => {
       const apps = data.applications || [];
       apps.push({
         id: crypto.randomUUID(),
         jobTitle: `Test Job ${i + 4}`,
         company: `Test Company ${i + 4}`,
         atsType: 'unknown',
         url: `https://example.com/job-${i + 4}`,
         appliedDate: new Date().toISOString(),
         status: 'applied',
         notes: ''
       });
       chrome.storage.local.set({ applications: apps });
     });
   }
   
   // Also increment volume count:
   chrome.storage.local.get('volumeData', (data) => {
     const today = new Date().toLocaleDateString('en-CA');
     chrome.storage.local.set({ 
       volumeData: { date: today, count: 15 } 
     });
   });
   ```

2. Refresh popup (close and reopen):
   - Open Tracker tab
   - Verify 15 applications listed
   - **Verify volume warning banner appears** (orange/yellow background)
   - Warning should say: "You've applied to 15 jobs today. Consider taking a break to avoid detection."

3. Test dismissal:
   - Click "Dismiss" on warning banner
   - Warning should disappear
   - Close and reopen popup
   - Warning should remain dismissed (localStorage persistence)

**Expected Results:**
- ✅ Volume warning appears at 15 applications
- ✅ Warning message is clear and helpful
- ✅ Dismiss button works
- ✅ Dismissal persists across popup reopens
- ✅ Dismissal resets at midnight (hard to test - trust code review)

---

## Test 5: Per-Job Disable Toggle (P0 BLOCKER)

**Objective:** Verify per-job disable toggle prevents autofill and AI features

**Steps:**

1. Return to the first Workday job URL from Test 1

2. Open extension popup → Tracker tab

3. Find the Workday application in list

4. Click the disable toggle next to the application:
   - Toggle should turn ON (blue/green active state)
   - Console should log: `[Job Disabled] Autofill and AI features disabled for: [URL]`

5. Refresh the Workday job page:
   - Autofill button should NOT appear
   - AI suggest button should NOT appear
   - Console should log: `[Autofill Button] Job disabled - skipping initialization`

6. Re-enable the job:
   - Toggle OFF in popup
   - Console should log: `[Job Enabled]`
   - Refresh page
   - Autofill button SHOULD appear again
   - AI suggest button SHOULD appear again

**Expected Results:**
- ✅ Toggle enables/disables successfully
- ✅ Autofill button removed when job disabled
- ✅ AI suggest removed when job disabled
- ✅ Features restored when job re-enabled
- ✅ Real-time sync (no page refresh needed for popup, but refresh needed for content scripts)

---

## Test 6: Duplicate Detection Warning (P2 NICE-TO-HAVE)

**Objective:** Verify duplicate detection warns but doesn't block

**Steps:**

1. Return to the same Workday job from Test 1

2. Fill and submit application again (same URL):
   - Complete form
   - Submit

3. Check console:
   - Look for: `[Submission Logger] Duplicate application detected`
   - Warning should appear but logging should CONTINUE

4. Check tracker:
   - Verify 16 applications total (duplicate was logged)
   - Both Workday applications should be in list

**Expected Results:**
- ✅ Console warning about duplicate
- ✅ Application logged anyway (warning, not block)
- ✅ Duplicate appears in tracker

---

## Test 7: CAPTCHA Blocking (P0 BLOCKER)

**Objective:** Verify CAPTCHA detection prevents logging

**Steps:**

1. Find a job page WITH CAPTCHA:
   - Some Workday/Greenhouse pages have reCAPTCHA
   - Alternative: Use reCAPTCHA demo page (https://www.google.com/recaptcha/api2/demo)

2. With CAPTCHA visible:
   - Extension badge should show ⚠️ (orange)
   - Fill form and try to submit
   - Console should show: `[Submission Logger] CAPTCHA present - aborting logging`

3. Verify NO logging occurred:
   - Check tracker - no new application added
   - Volume count unchanged

4. Solve CAPTCHA and resubmit:
   - Complete CAPTCHA challenge
   - Badge should clear (no ⚠️)
   - Submit form again
   - Logging should work normally

**Expected Results:**
- ✅ Badge shows ⚠️ when CAPTCHA present
- ✅ NO logging while CAPTCHA visible
- ✅ Console logs "CAPTCHA present - aborting"
- ✅ Logging resumes after CAPTCHA solved

---

## Summary Checklist

After completing all tests, verify:

- [ ] Workday submission logged correctly
- [ ] Greenhouse submission logged correctly
- [ ] Lever submission logged correctly
- [ ] Volume warning appeared at 15 apps
- [ ] Per-job disable toggle works
- [ ] CAPTCHA detection blocks logging
- [ ] CAPTCHA badge notification works
- [ ] Duplicate detection warns (but doesn't block)
- [ ] All job titles/companies extracted (or fallback values used)
- [ ] All dates are today's date
- [ ] Volume count increments correctly
- [ ] Tracker UI displays all applications

  </how-to-verify>

  <resume-signal>
Type one of the following:

**If all tests passed:**
```
APPROVED - All 3 platforms tested successfully. CAPTCHA blocking confirmed. Volume warning working.
```

**If issues found:**
```
ISSUES FOUND:
- [List specific failures with platform, test number, and expected vs actual behavior]
- [Example: "Test 1 (Workday): Job title not extracted - showed 'Unknown Position' instead of actual title"]
- [Example: "Test 5 (Disable toggle): Autofill button still appeared after disabling job"]
```

Claude will create fix tasks for any reported issues before proceeding to next phase.
  </resume-signal>
</task>

</tasks>

<verification>
This is a checkpoint plan - verification is performed by human tester following the test protocol above.

Phase 4 cannot be marked complete until this checkpoint is approved.
</verification>

<success_criteria>
- All 3 ATS platforms tested (Workday, Greenhouse, Lever)
- Submission logging verified on each platform
- CAPTCHA detection confirmed blocking logging
- Volume warning confirmed at 15 apps threshold
- Per-job disable toggle confirmed working
- Human tester approves all tests with "APPROVED" signal
</success_criteria>

<output>
After human approval, create `.planning/phases/04-job-tracker-safety/04-08-SUMMARY.md` documenting:
- Which platforms were tested
- Test results for each scenario
- Any edge cases discovered
- Confirmation that Phase 4 is production-ready
</output>
