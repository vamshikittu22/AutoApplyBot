---
phase: 04-job-tracker-safety
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/tracker/storage.ts
  - src/lib/safety/volume-limiter.ts
  - src/entrypoints/content/submission-logger.ts
  - src/entrypoints/popup/components/TrackerFilters.tsx
  - src/components/AISettings.test.tsx
  - src/lib/tracker/storage.test.ts
  - src/lib/store/tracker-store.test.ts
  - src/entrypoints/content/submission-logger.test.ts
  - src/lib/safety/captcha-detector.test.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "TypeScript strict type checking passes with zero errors"
    - "All chrome.storage.local.get() calls have explicit type assertions"
    - "Session storage access has proper PendingSubmission typing"
    - "Test files have proper null checks and unused imports removed"
  artifacts:
    - path: "src/lib/tracker/storage.ts"
      provides: "Type-safe chrome.storage.local.get with TrackedApplication[]"
      min_lines: 114
    - path: "src/lib/safety/volume-limiter.ts"
      provides: "Type-safe chrome.storage.local.get with VolumeData"
      min_lines: 80
    - path: "src/entrypoints/content/submission-logger.ts"
      provides: "Type-safe session storage access for PendingSubmission"
      min_lines: 394
    - path: "src/entrypoints/popup/components/TrackerFilters.tsx"
      provides: "Clean imports without unused declarations"
      min_lines: 153
  key_links:
    - from: "src/lib/tracker/storage.ts"
      to: "chrome.storage.local"
      via: "Type assertion as { applications?: TrackedApplication[] }"
      pattern: "chrome\\.storage\\.local\\.get.*as \\{"
    - from: "src/lib/safety/volume-limiter.ts"
      to: "chrome.storage.local"
      via: "Type assertion as { volumeData?: VolumeData }"
      pattern: "chrome\\.storage\\.local\\.get.*as \\{"
    - from: "src/entrypoints/content/submission-logger.ts"
      to: "chrome.storage.session"
      via: "Type assertion as { pendingSubmission?: PendingSubmission }"
      pattern: "chrome\\.storage\\.session\\.get.*as \\{"
---

<objective>
Fix all 24 TypeScript strict mode errors in storage, volume-limiter, submission-logger, and test files.

Purpose: Ensure type safety and pass TypeScript strict checks before phase completion
Output: Zero TypeScript errors when running `pnpm type-check`
</objective>

<execution_context>
@C:/Users/kittu/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/kittu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-job-tracker-safety/04-01-SUMMARY.md
@.planning/phases/04-job-tracker-safety/04-02-SUMMARY.md
@.planning/phases/04-job-tracker-safety/04-03-SUMMARY.md
@.planning/phases/04-job-tracker-safety/04-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix chrome.storage.local.get() type assertions</name>
  <files>
    src/lib/tracker/storage.ts
    src/lib/safety/volume-limiter.ts
  </files>
  <action>
**Fix storage.ts (6 errors):**

Lines 26, 48, 70, 90: Add explicit type assertion for chrome.storage.local.get() result

Change:
```typescript
const { applications = [] } = await chrome.storage.local.get(STORAGE_KEY);
```

To:
```typescript
const { applications = [] } = (await chrome.storage.local.get(STORAGE_KEY)) as { applications?: TrackedApplication[] };
```

Apply to all 4 occurrences (saveApplication, getApplications, updateApplication, deleteApplication).

**Fix volume-limiter.ts (1 error):**

Line 25: Add explicit type assertion for chrome.storage.local.get() result

Change:
```typescript
const { [STORAGE_KEY]: volumeData } = await chrome.storage.local.get(STORAGE_KEY);
```

To:
```typescript
const { [STORAGE_KEY]: volumeData } = (await chrome.storage.local.get(STORAGE_KEY)) as { [STORAGE_KEY]?: VolumeData };
```

**Why this approach:** Chrome Storage API returns `Promise<{ [key: string]: any }>` which TypeScript strict mode treats as `unknown`. Explicit type assertions tell TypeScript the expected shape while maintaining runtime default value safety with destructuring defaults.
  </action>
  <verify>Run `pnpm type-check` and confirm storage.ts and volume-limiter.ts have zero errors</verify>
  <done>TypeScript strict mode passes for storage.ts (0 errors) and volume-limiter.ts (0 errors)</done>
</task>

<task type="auto">
  <name>Task 2: Fix session storage typing and unused imports</name>
  <files>
    src/entrypoints/content/submission-logger.ts
    src/entrypoints/popup/components/TrackerFilters.tsx
  </files>
  <action>
**Fix submission-logger.ts (2 errors):**

Lines 198, 205, 212: Add explicit type assertion for chrome.storage.session.get() result

Change:
```typescript
const { pendingSubmission } = await chrome.storage.session.get('pendingSubmission');
```

To:
```typescript
const { pendingSubmission } = (await chrome.storage.session.get('pendingSubmission')) as { pendingSubmission?: PendingSubmission };
```

**Fix TrackerFilters.tsx (1 error):**

Line 14: Remove unused type imports

Change:
```typescript
import type { ApplicationStatus, ATSPlatform } from '@/types/tracker';
```

To:
```typescript
// Remove this import - ApplicationStatus and ATSPlatform not used in this component
```

Verify the component only uses string values in select options, not the actual types.

**Why this approach:** Session storage has same typing issue as local storage. Unused imports violate TypeScript strict mode rules and should be removed to keep imports clean.
  </action>
  <verify>Run `pnpm type-check` and confirm submission-logger.ts and TrackerFilters.tsx have zero errors</verify>
  <done>TypeScript strict mode passes for submission-logger.ts (0 errors) and TrackerFilters.tsx (0 errors)</done>
</task>

<task type="auto">
  <name>Task 3: Fix test file TypeScript errors</name>
  <files>
    src/components/AISettings.test.tsx
    src/lib/tracker/storage.test.ts
    src/lib/store/tracker-store.test.ts
    src/entrypoints/content/submission-logger.test.ts
    src/lib/safety/captcha-detector.test.ts
  </files>
  <action>
**Fix AISettings.test.tsx (4 errors):**

Lines 49, 50, 74, 75: Add non-null assertions for getByRole results

Change:
```typescript
await userEvent.click(getByRole('button', { name: /save/i }));
await userEvent.type(getByRole('textbox'), 'test-key');
```

To:
```typescript
await userEvent.click(getByRole('button', { name: /save/i })!);
await userEvent.type(getByRole('textbox')!, 'test-key');
```

**Fix storage.test.ts (5 errors):**

Lines 191, 192, 193, 386: Add non-null assertions or optional chaining

Change:
```typescript
expect(apps[0].id).toBe('test-id');
```

To:
```typescript
expect(apps[0]?.id).toBe('test-id');
```

**Fix tracker-store.test.ts (2 errors):**

Lines 95, 126: Add non-null assertions for find() results

Change:
```typescript
const app = get().applications.find(a => a.id === 'test-id');
expect(app.status).toBe('interview');
```

To:
```typescript
const app = get().applications.find(a => a.id === 'test-id');
expect(app?.status).toBe('interview');
```

**Fix submission-logger.test.ts (1 error):**

Line 5: Remove unused import `beforeEach`

Change:
```typescript
import { describe, it, expect, vi, afterEach, beforeEach } from 'vitest';
```

To:
```typescript
import { describe, it, expect, vi, afterEach } from 'vitest';
```

Line 6: Add @ts-ignore for jsdom missing types (alternative to installing @types/jsdom)

Add before import:
```typescript
// @ts-ignore - jsdom types not needed for test environment
import { JSDOM } from 'jsdom';
```

**Fix captcha-detector.test.ts (1 error):**

Line 5: Remove unused import `beforeEach`

Change:
```typescript
import { describe, it, expect, beforeEach } from 'vitest';
```

To:
```typescript
import { describe, it, expect } from 'vitest';
```

**Why this approach:** Test files need proper null checks for array access and DOM query results. Unused imports should be removed. Using `@ts-ignore` for jsdom is acceptable in test files rather than adding dev dependency for types.
  </action>
  <verify>Run `pnpm type-check` and confirm zero TypeScript errors across all files</verify>
  <done>All TypeScript strict mode errors fixed (24/24), `pnpm type-check` exits with code 0</done>
</task>

</tasks>

<verification>
Run full TypeScript check:
```bash
pnpm type-check
```

Expected output: Zero errors, clean exit code 0

Verify specific files:
```bash
# Check storage files
pnpm tsc --noEmit src/lib/tracker/storage.ts
pnpm tsc --noEmit src/lib/safety/volume-limiter.ts

# Check content script
pnpm tsc --noEmit src/entrypoints/content/submission-logger.ts

# Check test files
pnpm tsc --noEmit src/lib/tracker/storage.test.ts
```

All should pass with zero errors.
</verification>

<success_criteria>
- Zero TypeScript errors when running `pnpm type-check`
- All chrome.storage.local.get() calls have explicit type assertions
- All chrome.storage.session.get() calls have explicit type assertions
- Test files use proper null checks and optional chaining
- Unused imports removed from all files
- No @ts-ignore or @ts-expect-error added except for jsdom import
- All existing tests still pass after type fixes
</success_criteria>

<output>
After completion, create `.planning/phases/04-job-tracker-safety/04-06-SUMMARY.md`
</output>
